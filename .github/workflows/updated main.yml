name: Gemini AI Auto Commit and Deploy

on:
  push:
    branches:
      - main

jobs:
  ai-commit-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      # 1Ô∏è‚É£ Checkout repository
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      # 2Ô∏è‚É£ Set up Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # 3Ô∏è‚É£ Install latest Gemini GenAI SDK
      - name: Install Dependencies
        run: |
          pip install --upgrade google-genai

      # 4Ô∏è‚É£ Run Gemini AI to auto-update website UI
      - name: Run Gemini AI to Update Website UI
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        run: |
          python << 'EOF'
          import os
          import subprocess
          import re
          from pathlib import Path
          from google import genai

          # Initialize Gemini client
          client = genai.Client(api_key=os.environ["GEMINI_API_KEY"])

          prompt = """
                  SYSTEM / ROLE
          
          Act as an expert Frontend Developer specializing in Soft Minimalist UI/UX and premium e-commerce experiences.
          
          PROJECT NAME
          
          page
          
          GOAL
          
          Create a high-end, minimalist e-commerce website for premium home goods named ‚Äúpage‚Äù.
          The website should feel calm, refined, and editorial, inspired by intentional living and timeless interiors.
          
          AESTHETIC
          
          Style: Soft Minimalism
          
          Color Palette (warm, modern, earthy):
          
          Background: #FAF9F7 (warm off-white)
          
          Secondary / Surfaces: #E6E1DB (soft stone)
          
          Accent / Borders: #C2B8AE (muted taupe)
          
          Primary Text: #3F3A36 (deep charcoal brown)
          
          Typography:
          
          Clean sans-serif only (Inter or System UI)
          
          Clear hierarchy using size, weight, and spacing
          
          Layout:
          
          Ample negative space (80px+ padding on major sections)
          
          Balanced grid-based layouts
          
          UI Details:
          
          Subtle borders
          
          Gentle hover and focus transitions
          
          No harsh shadows or loud visual effects
          
          STRICT CONSTRAINTS
          1. Images
          
          Use ONLY image paths from assets/images/
          
          Generate images if you can
          
          If a specific product image is unknown:
          
          Use a neutral colored <div> with a subtle border as a placeholder
          
          2. Naming
          
          Website name must be ‚Äúpage‚Äù
          
          All navigation labels and internal references must include the word ‚Äúpage‚Äù
          
          Examples:
          
          Home page
          
          About page
          
          Product page
          
          3. Structure & Technology
          
          Generate semantic HTML5
          
          Use Tailwind CSS (utility-first) or equivalent internal utility CSS
          
          No backend logic
          
          No JavaScript frameworks
          
          Output must be a single HTML file with internal CSS
          
          PAGES TO GENERATE
          1. Home page
          
          Hero section with strong typography
          
          Headline theme: ‚ÄúCurated Living‚Äù
          
          Short philosophy statement describing the brand‚Äôs approach to refined living
          
          Featured collection grid (2‚Äì3 products)
          
          Product cards include:
          
          Image from assets/images/ or placeholder div
          
          Product name
          
          Price
          
          Subtle hover interactions
          
          2. Product Listing Page (PLP)
          
          Refined 2-column layout (mobile) / 3-column layout (desktop)
          
          Clean, spacious product grid
          
          Each product card includes:
          
          Image or placeholder
          
          Product name
          
          Price
          
          Gentle hover effects (border, opacity, or slight translate)
          
          3. Product Detail Page (PDP)
          
          Typography-first layout with generous whitespace
          
          Elements:
          
          Product name
          
          Price
          
          Detailed product description
          
          ‚ÄúAdd to Bag‚Äù button
          
          Button includes hover and active states (visual only)
          
          4. About Page
          
          Write 3 meaningful paragraphs about ‚Äúpage‚Äù:
          
          Paragraph 1: Craftsmanship, attention to detail, and thoughtful design
          
          Paragraph 2: Sustainability, responsible sourcing, and longevity
          
          Paragraph 3: The ‚Äúquiet home‚Äù movement and intentional living
          
          Tone: warm, calm, premium, and human
          
          INTERACTIVITY (STATIC ONLY)
          
          Use CSS-based interactions only:
          
          Hover states
          
          Focus styles
          
          Smooth transitions
          
          Interactions should feel subtle, calm, and premium
          
          OUTPUT REQUIREMENTS
          
          Single-file HTML output
          
          Internal CSS or Tailwind-style utilities
          
          Fully responsive (mobile-first)
          
          Clean, readable, well-structured code
          
          Cohesive and premium visual experience
          
          FINAL EXPECTATION
          
          The final result should resemble a luxury boutique home-goods brand‚Äî
          quiet, confident, timeless, and editorial‚Äîwithout visual clutter.
          Return each file strictly in the format:
          ---filename.ext---
          <file content>
          """

          # Generate content
          response = client.models.generate_content(
              model="gemini-3-flash-preview",
              contents=prompt
          )

          output = response.text

          # Parse and write files
          matches = re.findall(r"---(.*?)---\n(.*?)(?=(?:---|$))", output, re.DOTALL)

          for filename, content in matches:
              path = Path(filename.strip())
              path.parent.mkdir(parents=True, exist_ok=True)
              path.write_text(content.strip(), encoding="utf-8")

          # Git commit & push
          subprocess.run(["git", "config", "--global", "user.name", "gemini-bot"])
          subprocess.run(["git", "config", "--global", "user.email", "bot@example.com"])
          subprocess.run(["git", "add", "."])
          subprocess.run(["git", "commit", "-m", "ü§ñ Gemini AI updated website UI"], check=False)
          subprocess.run(["git", "push"])
          EOF

      # 5Ô∏è‚É£ Configure AWS credentials
      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-east-2

      # 6Ô∏è‚É£ Deploy to S3
      - name: Deploy to S3
        run: |
          aws s3 sync . s3://staticwebzsitegit --delete
