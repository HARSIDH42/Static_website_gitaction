function addToCart(productId) {
    const product = PRODUCTS.find(p => p.id === productId);
    const existing = cart.find(item => item.id === productId);

    if (existing) {
        existing.quantity += 1;
    } else {
        cart.push({ ...product, quantity: 1 });
    }

    saveCart();
    updateCartUI();
    
    // Provide visual feedback
    const btn = document.querySelector('.add-to-cart-btn');
    if (btn) {
        const originalText = btn.innerText;
        btn.innerText = "Added to Bag";
        btn.disabled = true;
        setTimeout(() => {
            btn.innerText = originalText;
            btn.disabled = false;
        }, 1500);
    }
}

function updateCartUI() {
    const list = document.getElementById('cart-items');
    const count = document.querySelector('.cart-count');
    const subtotalEl = document.getElementById('cart-subtotal');
    
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

    count.innerText = totalItems;
    subtotalEl.innerText = `$${subtotal.toFixed(2)}`;

    if (cart.length === 0) {
        list.innerHTML = `<p class="empty-msg">Your bag is currently empty.</p>`;
    } else {
        list.innerHTML = cart.map(item => `
            <div class="cart-item">
                <div class="img-container" style="margin:0; aspect-ratio:1/1;"></div>
                <div class="item-details">
                    <h4>${item.name}</h4>
                    <p class="price">$${item.price.toFixed(2)}</p>
                    <div class="qty-selector">
                        <button onclick="updateQty(${item.id}, -1)">-</button>
                        <span>${item.quantity}</span>
                        <button onclick="updateQty(${item.id}, 1)">+</button>
                    </div>
                </div>
                <button onclick="removeFromCart(${item.id})" aria-label="Remove">Ã—</button>
            </div>
        `).join('');
    }
}

function updateQty(id, delta) {
    const item = cart.find(i => i.id === id);
    if (item) {
        item.quantity += delta;
        if (item.quantity <= 0) return removeFromCart(id);
        saveCart();
        updateCartUI();
    }
}

function removeFromCart(id) {
    cart = cart.filter(i => i.id !== id);
    saveCart();
    updateCartUI();
}

function saveCart() {
    localStorage.setItem('essentials_cart', JSON.stringify(cart));
}

function toggleCart() {
    const drawer = document.getElementById('cart-drawer');
    const isActive = drawer.classList.toggle('active');
    drawer.setAttribute('aria-hidden', !isActive);
}

//